# 监控功能使用指南

## 📡 功能概述

监控功能是本项目的核心特性之一，可以实现：

- **自动轮询**: 定时爬取已配置用户的最新帖子
- **关键词过滤**: 智能匹配指定关键词
- **实时通知**: 命中关键词立即弹窗提醒
- **可视化管理**: 图形化界面配置和管理

## 🎯 使用场景

### 场景1: 品牌监控
监控竞争对手或行业KOL的动态，及时获取产品发布、促销活动等信息。

```
关键词: 新品、发布会、优惠、折扣
监控账号: 品牌官方微博
```

### 场景2: 舆情监测
监控特定话题或事件的相关讨论。

```
关键词: 事件名称、品牌名
监控账号: 相关媒体账号
```

### 场景3: 商机捕获
监控潜在客户的需求信息。

```
关键词: 求购、需要、寻找
监控账号: 行业群体账号
```

## 📋 快速开始

### 步骤1: 配置监控用户

在"任务管理"页面先添加要监控的用户：
1. 选择平台（微博/抖音）
2. 输入用户ID
3. 点击"开始爬取"（首次爬取，建立基线）

### 步骤2: 设置关键词

切换到"📡 监控管理"页面：

1. **添加关键词**
   - 在关键词输入框输入要监控的词
   - 点击"➕ 添加"或按回车
   - 可以添加多个关键词

2. **选择匹配模式**
   - **任意匹配**: 命中任何一个关键词就通知（推荐）
   - **全部匹配**: 必须同时包含所有关键词才通知

3. **设置监控间隔**
   - 建议设置 60-300 秒
   - 间隔太短可能被平台限制
   - 间隔太长可能错过及时性信息

### 步骤3: 启动监控

1. 点击"🚀 启动监控"按钮
2. 观察状态显示"运行中"
3. 监控日志会显示实时进度

### 步骤4: 接收通知

当有新帖子命中关键词时：

1. **弹窗通知**
   - 自动弹出通知窗口
   - 显示匹配的关键词（高亮显示）
   - 展示帖子完整内容
   - 包含用户信息和统计数据

2. **状态栏提示**
   - 底部状态栏显示匹配信息
   
3. **日志记录**
   - 监控日志记录所有匹配事件

## 🔧 配置详解

### 监控间隔

```
推荐设置:
- 实时性要求高: 60-120秒
- 一般监控: 180-300秒
- 低频监控: 300-600秒

注意: 间隔越短，对平台请求越频繁，可能触发限制
```

### 关键词设置

#### 关键词示例

**产品类**
```
新品、上市、发布、预售、开售
```

**促销类**
```
优惠、折扣、特价、促销、限时
```

**事件类**
```
发布会、活动、直播、抽奖
```

**需求类**
```
求购、需要、寻找、收购、采购
```

#### 关键词技巧

1. **使用核心词**: 选择最能代表目标信息的词
2. **避免过于宽泛**: "的"、"了"等通用词不适合
3. **组合使用**: 可以设置多个相关关键词
4. **定期优化**: 根据匹配结果调整关键词列表

### 匹配模式

#### 任意匹配（推荐）

```
关键词: [新品, 发布, 优惠]
匹配规则: 包含任一关键词即通知

示例:
✅ "新品上市！限时优惠"  → 匹配（新品、优惠）
✅ "明天发布会见"        → 匹配（发布）
✅ "今日特价优惠"        → 匹配（优惠）
```

#### 全部匹配

```
关键词: [新品, 优惠]
匹配规则: 必须同时包含所有关键词

示例:
✅ "新品上市优惠价"      → 匹配（包含新品和优惠）
❌ "新品发布会"          → 不匹配（只有新品）
❌ "限时优惠活动"        → 不匹配（只有优惠）
```

## 📊 通知界面说明

### 通知弹窗内容

```
┌─────────────────────────────────┐
│ 🔔 关键词匹配通知               │
├─────────────────────────────────┤
│ 📬 发现匹配的新帖子！           │
│ 匹配关键词: 新品, 优惠          │
├─────────────────────────────────┤
│ 用户: 某某品牌 [WEIBO]          │
│ 发布时间: 2026-01-19 14:30      │
│                                 │
│ 内容:                           │
│ ┌─────────────────────────────┐ │
│ │ 🎉【新品】发布！限时【优惠】 │ │
│ │ 立即购买享8折...            │ │
│ └─────────────────────────────┘ │
│                                 │
│ 👍 1.2k  💬 89  🔄 245         │
│ 🔗 查看原帖                     │
├─────────────────────────────────┤
│      [📝 查看详情]  [关闭]      │
└─────────────────────────────────┘
```

### 关键词高亮

通知窗口会自动高亮匹配的关键词：
- 黄色背景
- 红色文字
- 加粗显示

便于快速识别匹配内容。

## 💡 使用技巧

### 1. 先手动爬取，再启动监控

```
推荐流程:
1. 添加用户
2. 手动爬取一次（获取历史数据）
3. 配置关键词
4. 启动监控（只关注新帖子）
```

这样可以避免历史帖子重复通知。

### 2. 分时段监控

```python
# 工作时间密集监控
白天 09:00-18:00: 60秒间隔

# 非工作时间低频监控
夜间 18:00-09:00: 300秒间隔
```

### 3. 关键词分级

```
高优先级: 新品、发布会、重大活动
中优先级: 优惠、促销、折扣
低优先级: 日常、分享、推荐
```

可以分别配置不同的监控任务。

### 4. 测试验证

启动监控前：
1. 先用小间隔测试（如30秒）
2. 观察是否能正常工作
3. 验证关键词匹配是否准确
4. 再调整为正常间隔

## ⚙️ 配置文件

监控配置保存在 `config/user_config.json`:

```json
{
  "monitor": {
    "enabled": true,
    "interval": 60,
    "keywords": ["新品", "优惠", "活动"],
    "match_mode": "any",
    "notification": true
  }
}
```

可以手动编辑该文件，或通过界面修改。

## 🚨 注意事项

### 1. 平台限制

- 微博/抖音有频率限制
- 过于频繁可能被封IP
- 建议配置合理的间隔（60秒以上）
- 必要时使用代理

### 2. 网络稳定性

- 需要保持网络连接
- 网络中断会停止监控
- 建议在稳定网络环境下运行

### 3. 资源占用

- 长时间运行会占用系统资源
- 定期重启程序
- 清理旧数据

### 4. 关键词隐私

- 关键词仅本地使用
- 不会上传到服务器
- 保护用户隐私

## 🔍 故障排查

### 问题1: 监控启动但没有通知

**可能原因:**
1. 没有新帖子发布
2. 新帖子不包含关键词
3. 关键词设置不当

**解决方法:**
- 检查监控日志
- 验证关键词是否正确
- 测试已知包含关键词的账号

### 问题2: 监控自动停止

**可能原因:**
1. 网络连接断开
2. 程序异常
3. 被平台限制

**解决方法:**
- 检查网络连接
- 查看错误日志
- 增加监控间隔
- 配置代理

### 问题3: 重复通知

**可能原因:**
1. 历史数据未过滤
2. 程序重启后重新检测

**解决方法:**
- 先手动爬取一次
- 等待一个监控周期
- 重启程序会清空已见记录

## 📈 优化建议

### 性能优化

1. **减少监控账号数量**
   - 只监控核心账号
   - 定期清理不活跃账号

2. **合理设置间隔**
   - 根据账号活跃度调整
   - 活跃账号可适当缩短间隔

3. **定期清理数据**
   - 删除旧帖子
   - 保持数据库精简

### 效果优化

1. **优化关键词**
   - 定期review匹配结果
   - 删除无效关键词
   - 添加新发现的有效词

2. **调整匹配模式**
   - 根据实际需求选择
   - 任意匹配: 覆盖面广
   - 全部匹配: 精确度高

3. **分类监控**
   - 不同账号配置不同关键词
   - 根据重要性设置不同间隔

## 🎓 进阶用法

### 1. 正则表达式（未来支持）

```python
# 未来版本可能支持正则表达式
关键词: r'新品.*上市'
匹配: "新品发布上市"、"新品即将上市"
```

### 2. 组合条件（未来支持）

```python
# AND条件
(新品 AND 优惠)

# OR条件
(新品 OR 发布)

# NOT条件
(新品 NOT 旧款)
```

### 3. 时间范围过滤（未来支持）

```python
# 只监控最近1小时的帖子
time_range: 1h

# 只在工作时间通知
notification_time: "09:00-18:00"
```

## 📞 技术支持

如果遇到问题：
1. 查看监控日志
2. 查看系统日志 `logs/crawler.log`
3. 检查配置文件 `config/user_config.json`
4. 参考完整文档 `使用说明.md`

---

**祝使用愉快！** 🎉

如有任何问题或建议，欢迎反馈！
